#!/usr/bin/env node --harmony

'use strict';

var program = require('commander');
var prompt = require('prompt');

var MopsConfig = require('../lib/util/MopsConfig');

program
  .option('-h, --host [host]', 'MongoDB Ops Manager Hostname and Port')
  .option('-u, --user [username]', 'MongoDB Ops Manager Username')
  .option('-a, --apiKey [apiKey]', 'MongoDB Ops Manager  API Key')
  .parse(process.argv);

var user = program.user;
var apiKey = program.apiKey;
var host = program.host;
var requiredFields = [];
if (!host) {
    requiredFields.push('host');
}
if (!user) {
    requiredFields.push('user');
}
if (!apiKey) {
    requiredFields.push('apiKey');
}

if (requiredFields.length > 0) {
    prompt.message = "Required Field";
    prompt.start();
    prompt.get(requiredFields, function (err, result) {
        if (err) {
            console.log("An error occurred");
        } else {
            if (!host) {
                host = result.host;
            }
            if (!user) {
                user = result.user;
            }
            if (!apiKey) {
                apiKey = result.apiKey;
            }
            login(host, user, apiKey);
        }
    });
} else {
    login(host, user, apiKey);
}

function login(host, user, apiKey) {
    var config = new MopsConfig();
    config.set('host', host);
    config.set('user', user);
    config.set('apiKey', apiKey);
    config.save();
}
